# Kamal deployment configuration for Better Coaching Web (Next.js)
service: bettercoaching-web

# Docker image (will be pushed to Docker Hub)
image: zelusottomayor/bettercoaching-web

# Deploy to DigitalOcean droplet
servers:
  web:
    hosts:
      - 143.110.169.251
    options:
      cpus: "1.0"
      memory: "1024m"

proxy:
  ssl: true
  hosts:
    - bettercoachingapp.com
    - www.bettercoachingapp.com
  app_port: 3001
  healthcheck:
    path: /
    interval: 5
    timeout: 30

# Extended timeouts for Next.js startup
deploy_timeout: 120
drain_timeout: 30
boot:
  limit: 120

registry:
  username: zelusottomayor
  password:
    - KAMAL_REGISTRY_PASSWORD

env:
  clear:
    NODE_ENV: production
    PORT: "3001"
    NEXT_PUBLIC_API_URL: https://api.bettercoachingapp.com
    BACKEND_API_URL: https://api.bettercoachingapp.com
  secret:
    - STRIPE_SECRET_KEY
    - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY
    - NEXT_PUBLIC_MIXPANEL_TOKEN

# Builder configuration
builder:
  arch: amd64
  dockerfile: Dockerfile.web
  args:
    NEXT_PUBLIC_API_URL: https://api.bettercoachingapp.com
  secrets:
    - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY
    - NEXT_PUBLIC_MIXPANEL_TOKEN

# SSH options
ssh:
  user: root
