# Kamal deployment configuration for Better Coaching Backend API
service: bettercoaching

# Docker image (will be pushed to Docker Hub)
image: zelusottomayor/bettercoaching

# Deploy to DigitalOcean droplet
servers:
  web:
    hosts:
      - 143.110.169.251
    options:
      cpus: "0.50"
      memory: "512m"

proxy:
  ssl: true
  hosts:
    - api.bettercoachingapp.com
  app_port: 3000
  healthcheck:
    path: /health
    interval: 10
    timeout: 5

registry:
  username: zelusottomayor
  password:
    - KAMAL_REGISTRY_PASSWORD

env:
  clear:
    NODE_ENV: production
    PORT: "3000"
  secret:
    - DATABASE_URL
    - JWT_SECRET
    - JWT_REFRESH_SECRET
    - ENCRYPTION_KEY
    - ANTHROPIC_API_KEY
    - OPENAI_API_KEY
    - GOOGLE_API_KEY
    - REVENUECAT_WEBHOOK_SECRET
    - CORS_ORIGIN

# PostgreSQL database with pgvector (internal network only, no public port)
accessories:
  db:
    image: pgvector/pgvector:pg16
    host: 143.110.169.251
    env:
      clear:
        POSTGRES_DB: bettercoaching_production
      secret:
        - POSTGRES_USER
        - POSTGRES_PASSWORD
    directories:
      - data:/var/lib/postgresql/data

# Builder configuration
builder:
  arch: amd64

# SSH options
ssh:
  user: root

# Boot timeout
boot:
  limit: 60
